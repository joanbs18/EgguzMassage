var e,t,s,i,r,o,a,n,c=e=>{throw TypeError(e)},l=(e,t,s)=>t.has(e)||c("Cannot "+s),u=(e,t,s)=>(l(e,t,"read from private field"),s?s.call(e):t.get(e)),d=(e,t,s)=>t.has(e)?c("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),h=(e,t,s,i)=>(l(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s),m=(e,t,s)=>(l(e,t,"access private method"),s);import{S as p,s as v,h as b,b as x,n as j,a as g,r as f,c as y,d as S,u as C,j as w}from"./main-TMu7r4j7.js";import{T as E,P as k,D as N}from"./Delete-BkyaD7gm.js";import{T}from"./Table-BPx89Zts.js";import{T as O}from"./Titulo-DdRxg6aV.js";import{M}from"./index-DRa42mXg.js";import{s as D}from"./index-D5cljlYI.js";import{P}from"./index-BpOHeROo.js";import"./asyncToGenerator-DX3FKLjN.js";import"./context-DXfS8Ex2.js";import"./index-DVcNaHlo.js";import"./index-D44HQ0ap.js";import"./PurePanel-Dki21GvB.js";import"./UnstableContext-COzKTUEN.js";import"./ActionButton-H1dhOI7V.js";import"./ContextIsolator-BekeklBG.js";import"./roundedArrow-CFp4R6hd.js";var q=(n=class extends p{constructor(a,n){super(),d(this,r),d(this,e),d(this,t),d(this,s),d(this,i),h(this,e,a),this.setOptions(n),this.bindMethods(),m(this,r,o).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var i;const r=this.options;this.options=u(this,e).defaultMutationOptions(t),v(this.options,r)||u(this,e).getMutationCache().notify({type:"observerOptionsUpdated",mutation:u(this,s),observer:this}),(null==r?void 0:r.mutationKey)&&this.options.mutationKey&&b(r.mutationKey)!==b(this.options.mutationKey)?this.reset():"pending"===(null==(i=u(this,s))?void 0:i.state.status)&&u(this,s).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||null==(e=u(this,s))||e.removeObserver(this)}onMutationUpdate(e){m(this,r,o).call(this),m(this,r,a).call(this,e)}getCurrentResult(){return u(this,t)}reset(){var e;null==(e=u(this,s))||e.removeObserver(this),h(this,s,void 0),m(this,r,o).call(this),m(this,r,a).call(this)}mutate(t,r){var o;return h(this,i,r),null==(o=u(this,s))||o.removeObserver(this),h(this,s,u(this,e).getMutationCache().build(u(this,e),this.options)),u(this,s).addObserver(this),u(this,s).execute(t)}},e=new WeakMap,t=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakSet,o=function(){var e;const i=(null==(e=u(this,s))?void 0:e.state)??x();h(this,t,{...i,isPending:"pending"===i.status,isSuccess:"success"===i.status,isError:"error"===i.status,isIdle:"idle"===i.status,mutate:this.mutate,reset:this.reset})},a=function(e){j.batch((()=>{var s,r,o,a,n,c,l,d;if(u(this,i)&&this.hasListeners()){const h=u(this,t).variables,m=u(this,t).context;"success"===(null==e?void 0:e.type)?(null==(r=(s=u(this,i)).onSuccess)||r.call(s,e.data,h,m),null==(a=(o=u(this,i)).onSettled)||a.call(o,e.data,null,h,m)):"error"===(null==e?void 0:e.type)&&(null==(c=(n=u(this,i)).onError)||c.call(n,e.error,h,m),null==(d=(l=u(this,i)).onSettled)||d.call(l,void 0,e.error,h,m))}this.listeners.forEach((e=>{e(u(this,t))}))}))},n);function F(){const[e,t]=f.useState(""),[s,i]=f.useState(""),[r,o]=f.useState(""),[a,n]=f.useState(null),[c,l]=f.useState(!1),u=g(),{data:d,error:h,isLoading:m}=C({queryKey:["servicios"],queryFn:async()=>{const e=await fetch("https://egguzmassage.com/api/servicios");if(!e.ok)throw new Error("Error al obtener los datos");return e.json()}}),p=function(e){const t=g(),[s]=f.useState((()=>new q(t,e)));f.useEffect((()=>{s.setOptions(e)}),[s,e]);const i=f.useSyncExternalStore(f.useCallback((e=>s.subscribe(j.batchCalls(e))),[s]),(()=>s.getCurrentResult()),(()=>s.getCurrentResult())),r=f.useCallback(((e,t)=>{s.mutate(e,t).catch(y)}),[s]);if(i.error&&S(s.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:r,mutateAsync:i.mutate}}({mutationFn:async e=>{const t=await fetch("https://egguzmassage.com/api/servicios",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Error al insertar el servicio");return t.json()},onSuccess:()=>{u.invalidateQueries(["servicios"]),t(""),i(""),o("")}}),v=async c=>{if(c.preventDefault(),!e||!s||!r)return void alert("Todos los campos son obligatorios");const d={nombre_servicio:e,duracion:s,descripcion:r};try{if(a){if(!(await fetch(`https://egguzmassage.com/api/servicios/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})).ok)throw new Error("Error al actualizar el servicio");D.success("Servicio actualizado con éxito")}else{if(!(await fetch("https://egguzmassage.com/api/servicios",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})).ok)throw new Error("Error al insertar el servicio");D.success("Servicio creado con éxito")}t(""),i(""),o(""),n(null),u.invalidateQueries(["servicios"]),l(!1)}catch(h){D.error(h.message||"Ocurrió un error")}};if(m)return w.jsx("p",{children:"Cargando..."});if(h)return w.jsxs("p",{children:["Error: ",h.message]});const b=[{key:"1",label:"Gestión de Servicios",children:w.jsx(T,{data:d,columns:["ID","Nombre","Duración","Descripción","Acción"],renderRow:(e,s)=>w.jsxs("tr",{children:[w.jsx("td",{children:e.id_servicio}),w.jsx("td",{children:e.nombre_servicio}),w.jsx("td",{children:e.duracion}),w.jsx("td",{children:e.descripcion}),w.jsxs("td",{className:"btn_table",children:[w.jsx("button",{className:"btn_edit",onClick:()=>(e=>{t(e.nombre_servicio),i(e.duracion),o(e.descripcion),n(e.id_servicio),l(!0)})(e),children:w.jsx(k,{})}),w.jsx(P,{title:"Eliminar servicio",description:"¿Estás seguro de eliminar este servicio?",onConfirm:()=>(async e=>{try{if(!(await fetch(`https://egguzmassage.com/api/servicios/${e}`,{method:"DELETE"})).ok)throw new Error("Error al eliminar el servicio");D.success("Servicio eliminado con éxito"),u.invalidateQueries(["servicios"])}catch(t){D.error("No se pudo eliminar el servicio")}})(e.id_servicio),onCancel:()=>D.info("Cancelado"),okText:"Sí",cancelText:"No",children:w.jsx("button",{className:"btn_delete",children:w.jsx(N,{})})})]})]},s)})},{key:"2",label:"Crear Servicio",children:w.jsxs("form",{onSubmit:v,children:[w.jsx("label",{htmlFor:"nombre",children:"Nombre Servicio:"}),w.jsx("input",{className:"input",type:"text",id:"nombre",name:"nombre",placeholder:"Ingresa el nombre del servicio",required:!0,value:e,onChange:e=>t(e.target.value)}),w.jsx("label",{htmlFor:"duracion",children:"Duración (Minutos):"}),w.jsx("input",{className:"input",type:"number",id:"duracion",name:"duracion",placeholder:"Ingresa la duración en minutos",required:!0,value:s,onChange:e=>i(e.target.value)}),w.jsx("label",{htmlFor:"descripcion",children:"Descripción:"}),w.jsx("textarea",{className:"input",id:"descripcion",name:"descripcion",placeholder:"Ingresa la descripción del servicio",required:!0,value:r,onChange:e=>o(e.target.value)}),w.jsx("button",{type:"submit",className:"boton--primario--admin",children:p.isLoading?"Guardando...":"Confirmar"})]})}];return w.jsxs(w.Fragment,{children:[w.jsx(O,{titulo:"Gestión Servicios"}),w.jsx(E,{items:b}),w.jsx(M,{title:a?"Actualizar Servicio":"Crear Servicio",open:c,onOk:v,onCancel:()=>l(!1),okText:p.isLoading?"Guardando...":"Confirmar",cancelText:"Cancelar",okButtonProps:{className:"btn-confirmar"},cancelButtonProps:{className:"btn-cancelar"},children:w.jsxs("form",{onSubmit:v,children:[w.jsx("label",{htmlFor:"nombre",children:"Nombre Servicio:"}),w.jsx("input",{className:"input",type:"text",id:"nombre",name:"nombre",placeholder:"Ingresa el nombre del servicio",required:!0,value:e,onChange:e=>t(e.target.value)}),w.jsx("label",{htmlFor:"duracion",children:"Duración (Minutos):"}),w.jsx("input",{className:"input",type:"number",id:"duracion",name:"duracion",placeholder:"Ingresa la duración en minutos",required:!0,value:s,onChange:e=>i(e.target.value)}),w.jsx("label",{htmlFor:"descripcion",children:"Descripción:"}),w.jsx("textarea",{className:"input",id:"descripcion",name:"descripcion",placeholder:"Ingresa la descripción del servicio",required:!0,value:r,onChange:e=>o(e.target.value)})]})})]})}export{F as default};
