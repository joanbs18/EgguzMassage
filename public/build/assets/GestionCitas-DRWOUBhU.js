import{r as e,a as r,u as t,j as a}from"./main-C7Ywe-tG.js";import{D as i,P as s,T as o}from"./Delete-qyogKbQz.js";import{T as n}from"./Table-TBZm-oj5.js";import{T as c}from"./Titulo-DlAaft1s.js";import{D as l,F as d}from"./FormCita-BD64NdtD.js";import{P as h}from"./index-B94cAhrP.js";import{s as m}from"./index-x7gCVMhX.js";import"./asyncToGenerator-7wRDpvCp.js";import"./context-DPFxEQzU.js";import"./index-B3H4a1K6.js";import"./index-B1eIwV2j.js";import"./PurePanel-D4LYmZiI.js";import"./ContextIsolator-zsZ5SGeW.js";import"./UnstableContext-EE9Z3Y2w.js";import"./roundedArrow-Cs2E5y2g.js";import"./ActionButton-DHSxoEgg.js";function j(){const[j,x]=e.useState(""),[p,u]=e.useState(null),f=r(),{data:g,error:y,isLoading:C}=t({queryKey:["citas"],queryFn:async()=>{const e=await fetch("https://egguzmassage.com/api/citas");if(!e.ok)throw new Error("Error al obtener los datos");return e.json()}}),{citasHoy:b,errorCitasHoy:E,isLoadingCitasHoy:_}=t({queryKey:["citasHoy"],queryFn:async()=>{const e=await fetch("https://egguzmassage.com/api/citas/hoy");if(!e.ok)throw new Error("Error al obtener los datos");return e.json()}}),v=async e=>{try{if(!(await fetch(`https://egguzmassage.com/api/citas/${e}`,{method:"DELETE"})).ok)throw new Error("Error al eliminar la cita");m.success("Cita eliminada correctamente"),await f.invalidateQueries(["citas"])}catch(r){m.error("No se pudo eliminar la cita")}},w=(null==g?void 0:g.filter((e=>{const r=e.cliente_nombre.toLowerCase().includes(j.toLowerCase())||e.fecha.includes(j)||e.hora.includes(j),t=!p||e.fecha===p;return r&&t})))||[],T=[{key:"1",label:"Gestión de citas",children:a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"search-date-filter",children:[a.jsx("input",{type:"text",placeholder:"Buscar cita...",value:j,onChange:e=>x(e.target.value),style:{marginBottom:"20px",padding:"10px",borderRadius:"5px",border:"1px solid #d9d9d9"}}),a.jsx(l,{onChange:(e,r)=>{u(r)},placeholder:"Filtrar por fecha",style:{marginBottom:"20px",padding:"8px"}})]}),a.jsx(n,{data:w,columns:["Cliente","Servicio","Motivo","Fecha","Hora","Correo","Teléfono","Estado","Acción"],renderRow:(e,r)=>a.jsxs("tr",{children:[a.jsx("td",{children:e.cliente_nombre}),a.jsx("td",{children:e.servicio.nombre_servicio}),a.jsx("td",{children:e.descripcion}),a.jsx("td",{children:e.fecha}),a.jsx("td",{children:e.hora}),a.jsx("td",{children:e.cliente_email}),a.jsx("td",{children:e.cliente_telefono}),a.jsx("td",{children:1===e.estado?"Activa":"Cancelada"}),a.jsx("td",{className:"btn_table",children:a.jsx(h,{title:"¿Eliminar cita?",description:"¿Está seguro que desea eliminar esta cita?",onConfirm:()=>v(e.id_cita),onCancel:()=>m.info("Cancelado"),okText:"Sí",cancelText:"No",children:a.jsx("button",{className:"btn_delete",children:a.jsx(i,{})})})})]},r)})]})},{key:"2",label:"Crear cita",children:a.jsx(d,{})},{key:"3",label:"Citas para Hoy",children:a.jsx(a.Fragment,{children:_?a.jsx("p",{children:"Cargando citas de hoy..."}):E?a.jsx("p",{children:"Error al cargar las citas de hoy"}):Array.isArray(b)&&0===b.length?a.jsx("p",{children:"No hay citas programadas para hoy."}):a.jsx(n,{data:b,columns:["Cliente","Servicio","Fecha","Hora","Correo","Teléfono","Estado","Acción"],renderRow:(e,r)=>a.jsxs("tr",{children:[a.jsx("td",{children:e.cliente_nombre}),a.jsx("td",{children:e.servicio.nombre_servicio}),a.jsx("td",{children:e.fecha}),a.jsx("td",{children:e.hora}),a.jsx("td",{children:e.cliente_email}),a.jsx("td",{children:e.cliente_telefono}),a.jsx("td",{children:1===e.estado?"Activa":"Cancelada"}),a.jsxs("td",{className:"btn_table",children:[a.jsx("button",{className:"btn_edit",onClick:()=>alert(`Editar Cita: ${e.cliente_nombre}`),children:a.jsx(s,{})}),a.jsx(h,{title:"¿Eliminar cita?",description:"¿Está seguro que desea eliminar esta cita?",onConfirm:()=>v(e.id_cita),onCancel:()=>m.info("Cancelado"),okText:"Sí",cancelText:"No",children:a.jsx("button",{className:"btn_delete",children:a.jsx(i,{})})})]})]},r)})})}];return C?a.jsx("p",{children:"Cargando..."}):y?a.jsxs("p",{children:["Error: ",y.message]}):a.jsxs(a.Fragment,{children:[a.jsx(c,{titulo:"Gestión Citas"}),a.jsx(o,{items:T})]})}export{j as default};
